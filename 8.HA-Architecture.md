# HA ARCHITECTURE

- **Availability:** can be described as the % of a time period when the service will be able to respond to your request in some fashion.
- **Durability:** refers to the on-going existence of the object or resource.
- **Resiliency:** can be described as the ability to a system to self heal after damage or an event.
- **Reliability:** is the probability that a system will work as designed. This term is not used much in AWS, but is still worth understanding.


## Elastic Load Balancers

It is a phisical or virtual device to load balance the network.


### Revision

![osi](https://user-images.githubusercontent.com/24825457/81094397-d1f89c80-8ed9-11ea-9354-0bff80cfa932.png)

Protocols:
  - Layer 7 (Application Layer): HTTP/HTTPS, FTP, SSH, POP3, SMTP, IMAP, SNMP, DNS, PING
  - Layer 4 (Transport Layer): TCP, UDP, RTP..
  - Layer 3 (Network Layer): IPv4, IPv6

### Types:

  - **Application Load Balancer:** 
    - HTTP/HTTPS traffic.
    - Operation at Application Layer (Layer 7).
    - Intelligent Routing (Path Patterns). Example, send requests to web server per country.
    - Target Groups.
  - **Network Load Balancer:** 
    - TCP traffic. 
    - Operation at the connection level (Layer 4).
    - Extreme performance.
  - **Classic Load Balancer:** 
    - Legacy Elastic Load Balancers.
    - HTTP/HTTPS trafic. Layer 7-specific features: X-Forwarded and sticky sessions.
    - TCP traffic. Layer 4.
    - Keep you costs down.
    - Don't need Intelligent Routing.

### Health Check

Helf checks check the instance heath by taking to it.
 
Configuration: 
![image](https://user-images.githubusercontent.com/24825457/81099716-babdad00-8ee1-11ea-8ffb-bcf36f553641.png)

Monitoring:

![image](https://user-images.githubusercontent.com/24825457/81100073-49322e80-8ee2-11ea-83ab-13257fb95fe7.png)

Instances monitored by ELB are reported as InService / OutofService 
 
### Stick Session

Stick Session enable your users to stick to the same EC2 instance. Can be usefull if you are storeing information locally to that instance.

  - Can configure for Classic Load Balance.
  - Can configure Stick Session for Application Load Balance, but traffic will be sent at the Target Group Level.
  
### Cross Zone Load Balancing

Cross Zone Load Balance enables you to load balance across zone.

### Path Patterns

Path Patterns allow you to direct traffic to different EC2 instance based on the URL contained in the request.

  - Can configure for Application Load Balance.
  - Microservices.

### TIPS
 - ~10 questions in exam.
 - 504 error (gateway timeout): application not responding within the idle timeout period (Web server layer or Database Layer).
 - If you need the IPv4 adderes of your end user, looock for the X-Forwarded-For header.
 - Load Balancers have their own DNS name. you are never given an IP address.
 - Read FAQ for Classic Load Balancers ()	

## AUTO SCALING



  - three components:
    - Groups: Logical component. Webserver, application or database group, etc.
    - Configuration Templates: groups use a launch template or a launch configuration. AMI ID, instance types, securit groups...
    - Scalling Options: rules to scale groups. 
    	- maintain current instance levels at all times
    	  - example, 10 EC2 when one unhealth, the scaling to 10 EC2 up
    	- scale manually
    	  - configure number of resource, when change configuration, auto scalling create or terminate instance.
    	- scale based on a schedule
    	  - scale by schedule using a function of datetime. Example, scale up 10 EC2 on 6:00 AM, and scale down 2 EC2 instance on 10:00 PM. 
    	- scale based on demand
    	  - scale using polices. Parameters to control the scaling process. Example, scale up a new EC2 instance when 50% CPU utilization.
    	  - most popular.
    	- use predictive scaling
    	  - NEW option
    	  - combination with EC2 Auto Scaling and Auto Scaling.
    	  - predictive and dynamic scaling (proactive and reactive aprroaches)

    	- Can configure Classic Load Balance
    	- Multiple Zone
    	- Delete Auto Scale Groups, delete de EC2 instances.


    	- launch configurations: configure launch configurations: AMI ID, bootstrap script, IP address type, security groups, etc..
    	- auto scaling groups: group size (number of instances), load balancing, heath checks. Scaling between 3 of 6 instances, average CPU utilization, target value (80% cpu), 60 seconds to scaling.

    - healthy checks can be load balance or EC2


three to four question in exams





## CLOUD FORMATION

[ADICIONAR UMA EXPLICAÇÃO SOBRE]


  - template json

  - template types:
    - Sample template
    - upload template to S3
    - specify an amazon S3 template URL


  - TIPS:
    - is a way of completely scriptiong your cloud environment
    - Quick Start = crate complex enviromnents very quickly
    - Cloud Formation is a way more powerfull than Elastic Beanstalk


## ELASTIC BEANSTALK

[ADICIONAR UMA EXPLICAÇÃO SOBRE]

  - Quickly deploy and manage applications. You simply upload your application, and Elastic Beanstalk automatically handles the etais of capacity provisioning, load balancing, scaling and application health monitoring.
  - it will grow out your infrastucture


## HA ARCHITECTURE - TIPS

  - Always design for failure.
  - Use Multiple AZ's and Multiple Regions where ever you can
  - Know the difference between Multi-AZ and Read Replicas for RDS
  - Know the difference between scaling out and scaling up
  - Read the question carefully and always consider the cost element.
  - Know the different S3 storage classes
    
Netflix Simian Army project, inject failure into the production systems.


